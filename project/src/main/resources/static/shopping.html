<!DOCTYPE html>
<html class="bit-html mobile-false " dir="ltr" lang="zh-CN"><!--<![endif]-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="renderer" content="webkit"> 
	<meta http-equiv="Cache-Control" content="no-transform"> <!-- for baidu -->
    <meta name="MobileOptimized" content="width"><!-- for baidu -->
    <meta name="HandheldFriendly" content="true"><!-- for baidu -->
   
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">	
	<title>我的购物车</title>
	<link rel="stylesheet" href="./css/herder.css" charset="utf-8">
	<!--<link rel="stylesheet" href="css/detail.css" charset="utf-8">-->
	<link rel="stylesheet" href="./css/shopping.css" charset="utf-8">
	<script type="text/javascript" src="./js/jquery.min.js"></script>
	<script type="text/javascript" src="./js/common.js"></script>
			
</head>

<body class="br">
	<div id="header"></div>
	
	<!--主体部分-->
	<div class="body_main">
		<div class="pay_body">
			<div class="bb_bar"></div>
			<div class="top_title">
				<span class="p1">所有产品 ></span>
				<span class="p1" id="item">您的购物车</span><br/>
				<span class="p2" id ="itemName">您的购物车</span>
			</div>
			<!--<div class="bb_bar"></div>-->
			<form name=alipayment action=alipaySum method=post target="_blank">  <!--这里的target为_blank是新打开一个窗口-->
				<!--商户订单号--><input type="hidden" id="WIDout_trade_no" name="WIDout_trade_no" />
				<!--订单名称--><input type="hidden"  id="WIDsubject" name="WIDsubject" />
				<!--付款金额--><input type="hidden"  id="WIDtotal_amount" name="WIDtotal_amount" />
				<!--商品描述--><input type="hidden"  id="WIDbody" name="WIDbody" />


				<div class="cart">
					<div class="handle" >
						<div class="gapbar"></div>
						<!--购物车商品列表-->
						<div class="cart_bar" id="cart_bar"></div>
						<div class="cart_bar"></div>
						<div class="slicer"></div>
						<div class="cart_tot">
							<div class="cartto">合计:</div>
							<div class="cartp" id="priceSum">￥</div>
						</div>
						<div class="cart_tot">
							<div class="cartto">支付方式:</div>
							<div class="cartp">支付宝</div>
						</div>
						<div class="cart_tot">
							<div class="sub"><button>提交支付</button></div>
						</div>
					</div>
					<!--购物车是空的-->
					<div class="emptyCar">
						<div class="empty_img">
							<img src="images/shippingCar.png"/>
						</div>
						<div class="empty_tex">
							<span>您的购物车是空的,您可以&nbsp;:</span></br>
							<span>看看我的&nbsp;</span><a href="personal_resou.html" style='text-decoration:none;'><sp class="emlian">个人中心</sp></a></br>
							<a href="index.html" style='text-decoration:none;'><sp class="emlian">继续浏览</sp></a><span>&nbsp;其他产品</span>
						</div>
					</div>
				</div>
			</form>
		</div>

	</div>
	<div id="footer"></div>

<script type="text/javascript" >
	$(function() {
		$('#header').load('header.html');
		$('#footer').load('footer.html');
	})

	let userId;   let phone;
	if(sessionStorage.getItem('userSession')!=null){
		userId = JSON.parse(sessionStorage.getItem('userSession')).userId;
		phone = JSON.parse(sessionStorage.getItem('userSession')).phone;
	}else {
		userId=0;
		phone=0;
	}

	$(document).ready(function() {
		$.ajax({
			url: 'order/shopping',
			type: 'POST',
			async: false,
			data: {phone: phone},
			success: function (result) {
				let dataList = result.data;
				if(dataList==null|| dataList==""){  /*购物车是空的*/
					$(".handle").css("display","none");
					$(".cart_tot").css("display","none");
					/*这里渲染一个空的图片*/
				}else {
					$(".emptyCar").css("display","none");  /*如果购物车有商品隐藏 空模块*/
					let html = "";
					let priceSum = 0;
					console.log(priceSum);
					for (let i in dataList) {
						let godosId = dataList[i].goodsId;
						html +=
							"<div class=\"cartm\">" +
								"<input type=\"hidden\" class=\"shoppingw\" name=\"shoppingId\" value='" + dataList[i].shoppingId + "'/>" +
								"<div class=\"barimg\"><span><img src=\"image/" + godosId +"/"+ dataList[i].goodsImgmain + "\"/></span></div>" +
								"<div class=\"gname\">" + dataList[i].goodsTitle + "</div>" +
								"<div class=\"ginfo\">" + dataList[i].shoppingId + "</div>" +
								"<div class=\"gprice\">￥" + dataList[i].goodsPrice + "</div>" +
								"<a href='javascript:;' class='remove'><div class=\"del\"><img src=\"images/delete.ico\" /></div></a>" +
							"</div>" +
							"<div class=\"gap\"></div>"
						priceSum += parseInt(dataList[i].goodsPrice);
					}
					$("#cart_bar").html(html);
					$("#priceSum").html("￥" + priceSum);
					$("#WIDout_trade_no").val(dataList[0].ordersId);
					$("#WIDsubject").val(dataList[0].goodsTitle);
					$("#WIDtotal_amount").val(priceSum);
					//$("#WIDbody").val("支持xx");
				}
			}
		})
	})

</script>

<script type="text/javascript" >
	/*点击删除按钮*/
	$(document).ready(function() {
		$(".remove").click(function () {
			let shoppingId = $(this).siblings(".shoppingw").val();
			$(this).parent().remove();/*删除页面的dom结构*/
			$.ajax({
				url: 'order/delShopping',
				type: 'POST',
				async: false,
				data: {shoppingId: shoppingId},
				success: function (result) {
					window.location.reload(); /*刷新当前页面*/
				}
			})
		});
	})
</script>

	

</body>
</html>