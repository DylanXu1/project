<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/xadmin.css">
    <link rel="stylesheet" href="../css/addItem.css">
    <script src="../js/jquery-3.4.1.js" charset="utf-8"></script>
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <script type="text/javascript" src="../ckeditor/ckeditor.js"></script>
</head>

<body>
<div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a><cite>添加项目</cite></a>
            </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
    </a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body "><!--正文的白色底框-->
                    <div class="bodyshade"  id="item_show">
                        <form action="/file/batchUpload" method="post" enctype="multipart/form-data" target="frameName" class="layui-form"><!--class="layui-col-md12  layui-form-pane "-->
                            <div class="layui-form-item" >
                                <label class="layui-form-label">项目分类</label>
                                <div class="layui-input-inline">
                                    <select id="meList" name="meList" lay-filter="list_1">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                            </div>
                            <!--通过选择项目类目的选择生成父ID-->
                            <input type="hidden" id="parentId" name="parentId" required="" autocomplete="off" class="layui-input">
                            <!--项目id自生成-->
                            <input type="hidden" class="itemId" name="itemId" required="" autocomplete="off" class="layui-input">

                            <div class="layui-form-item">
                                <label class="layui-form-label">项目名称</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="itemName" name="itemName" required="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">项目标题</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="title" name="title" required="" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">项目发行人</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="developer" name="developer" required="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">原价</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="originalPrice" name="originalPrice" required="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">现价</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="price" name="price" required="" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid layui-word-aux">免费项目将现价设为 0</div>
                            </div>
                           <!-- <div class="layui-form-item" >
                                <label class="layui-form-label">项目介绍</label>
                                <div class="layui-input-inline">
                                    <textarea type="text" id="introduce" name="introduce" required="" autocomplete="off" class="layui-input"></textarea>
                                </div>
                                <div class="layui-form-mid layui-word-aux">拖动输入框右下角可调整输入框大小</div>
                            </div>-->

                            <div style="width: 100%">
                                <div class="layui-form-item" >
                                    <label class="layui-form-label">项目介绍</label>
                                </div>
                                <textarea type="text" id="introduce" name="introduce" ></textarea>
                                <script type="text/javascript">CKEDITOR.replace('introduce');</script>
                            </div>
                            <hr>

                            <div class="layui-form-item" >
                                <label class="layui-form-label">图片信息</label>
                            </div>

                            <div class="layui-form-item lfi" >
                                <!--主图-->
                                <div class="layui-inline">
                                    <div class="bu"><!--添加主图按钮-->
                                        <input class="change" type="file" id="mainFile" name="mainFile" accept="image/*" multiple="multiple" οnchange="changImg(event)" >
                                    </div>
                                    <div class="state">说明！ 上传图片的长宽比5:3 最佳，长宽比率不佳的图片会影响展示效果</div>
                                </div>
                                <div class="lii_img" id="mainimg"></div>

                                <div class="layui-inline lii2">
                                    <div class="bu2">
                                        <input class="change" type="file" id="files" name="files" accept="image/*" multiple="multiple" οnchange="changImg(event)" >
                                    </div>
                                    <div class="bo" id="container"><!--添加图片列表-->
                                        <div class="img_list" id="img_list" ><img id="drag1" src="/images/empty.png" /></div>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item" >
                                <div class="sub_button">
                                    <button class="layui-btn" id="add_item" lay-filter="add" lay-submit="" onclick="save()">完成</button>
                                </div>
                            </div>
                        </form>
                        <iframe id="id_iframe" name="frameName" style="display:none;"></iframe><br/>
                    </div>
                </div>
                <hr>
<!--========================================================================================================================-->
                <div id="echo_item">
                   <!-- <div class="display_box">
                        <div><div class="display_title">项目分类：</div><div class="display_row" id="echo_parentId">'+ echo_itemId +'</div></div>
                        <div class="row_line"></div>
                        <div><div class="display_title">项目ID：</div><div class="display_row" id="echo_itemId">'+ echo_itemId +'</div></div>
                        <div><div class="display_title">项目名称：</div><div class="display_row" id="echo_item_name">'+ echo_itemName +'</div></div>
                        <div><div class="display_title">项目标题：</div><div class="display_row" id="echo_title">'+ echo_title +'</div></div>
                        <div><div class="display_title">发行人：</div><div class="display_row" id="echo_developer">'+ echo_developer +'</div></div>
                        <div><div class="display_title">项目原价：</div><div class="display_row" id="echo_originalPrice">'+ echo_originalPrice +'</div></div>
                        <div><div class="display_title">项目现价：</div><div class="display_row" id="echo_price">'+ echo_price +'</div></div>
                        <div>
                            <div class="display_title">内容：</div>
                            <div class="display_row">
                                <div class="content"><div id="echo_introduce"></div>'+ echo_introduce +'</div>
                                </div>
                            </div>
                        <div><div class="display_title">主图片：</div><div class="display_row"><img id="echo_imgMain" src="/image/'+ echo_itemId +'/'+ echo_imgMain +'"/></div></div>
                        <div>
                            <div class="display_title">副图片：</div>
                            <div class="display_row">
                                <img id="echo_listImg1" src="/image/1002/1-2.png"/>
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>-->
                </div>


<!--========================================================================================================================-->
                <div class="layui-form-item" style="width: 1010px">
                    <div class="mod_int">在此处添加项目详情介绍，点击右边新增，可以新增一段介绍</div>
                    <div class="mod_but">
                        <button id="add_intro">新&nbsp;增</button>
                    </div>
                </div>
                <hr>
<!--========================================================================================================================-->
                <div id="echo">
                    <!--<div class="display_box">
                        <div >
                            <div class="display_row">项目ID：</div><div class="display_row" id="introduce_itemId">1000000001</div>
                        </div>
                        <div>
                            <div class="display_title">标题：</div><div class="display_row" id="introduce_title">&lt;!&ndash;标题&ndash;&gt;</div>
                        </div>
                        <div >
                            <div class="display_title">内容：</div>
                            <div class="display_row">
                                <div class="content">
                                    <div id="introduce_content">&lt;!&ndash;内容&ndash;&gt;</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="display_title">图片：</div><div class="display_row"><img id="introduce_img" src="/image/1001/car.png"/></div>
                        </div>
                        <div class="line"></div>
                    </div>-->
                </div>
<!--========================================================================================================================-->
                <div class="layui-card-body" id="intro_show"><!--正文的白色底框-->
                    <div class="bodyshade">
                        <form action="/file/introduceUpload" id="introform" method="post" enctype="multipart/form-data" target="frameName" class="layui-form"><!--class="layui-form layui-col-md12  layui-form-pane"-->
                            <!--项目id自生成-->
                            <input type="hidden" class="itemId" name="itemId" required="" autocomplete="off" class="layui-input">
                            <div class="layui-form-item">
                                <label class="layui-form-label">标题介绍</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="introTitle" name="introTitle" required="" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div style="width: 100%">
                                <div class="layui-form-item"><!--class="layui-form-item" -->
                                    <label >介绍内容</label>
                                </div>

                                <textarea type="text" id="content" name="content" ></textarea>
                                <script type="text/javascript">CKEDITOR.replace('content');</script>
                            </div>

                            <div class="layui-form-item lfi2" >
                                <!--主图-->
                                <div class="layui-inline">
                                    <div class="bu2"><!--添加介绍图按钮-->
                                        <input class="change" type="file" id="introImgFile" name="introImgFile" accept="image/*" multiple="multiple" οnchange="changImg(event)" >
                                    </div>
                                    <div class="lfi2_img" id="introImg"></div>
                                </div>
                            </div>
                            <div class="layui-form-item" >
                                <div class="sub_button">
                                    <button class="layui-btn" id="add_1" lay-filter="add" lay-submit="" >完成</button>
                                </div>
                            </div>
                        </form>
                        <iframe id="id_iframe1" name="frameName" style="display:none;"></iframe><br/>
                    </div>
                    <div style="height: 50px"></div>
                </div>
                <hr>

                <div class="layui-card-body " style="height: 100px"></div>
            </div>
        </div>
    </div>
</div>

<script  type="text/javascript">

layui.use('form', function(){
    var form = layui.form;
    var element = layui.element;
    var  layer = layui.layer;

    $.post('/item/sysMenuList',{},function(data){
        let dataList = data.data;
        //声明一个函数
        function menuList(dataList){
            let meList = "";
            for (let i = 0; i < dataList.length; i++) {
                let me = dataList[i].menuName;
                let sysId = dataList[i].sysId;  /*菜单的id*/
                meList += '<option value="'+ sysId +'">'+ me +'</option>';
            }
            $("#meList").append(meList)
            form.render();  /*动态添加数据需要重新渲染*/
        };
        menuList(dataList);  /*调用加载主菜单列表函数*/
    });

    /*监听选中的值*/
    form.on('select(list_1)', function (data) {    /*list_1为lay-filter的值*/
        let pitch = $("select[name=meList]").val();  /*获取攒中菜单的id*/
       $("#parentId").val(pitch);   /*该值作为待添加项目的父id*/
    })

    $(document).ready(function () {
        /*自动生成itemId*/
        let date = new Date();
        let dateString = JSON.stringify(date); //将时间生成字符串
        let snum = dateString.replace(/[^0-9]/ig,""); //去除非数字字符
        let xx = snum.substring(snum.length-7); //取字符串的后7位
        let randItem = Math.floor(Math.random() * 100+10); //随即成生两位整数(有时可能三位)
        let itemId = randItem + xx;
        $(".itemId").val(itemId);
    })

    /*点击添加主图*/
    $(document).on("change","#mainFile",function () {
        let fr = new FileReader();
        fr.readAsDataURL(this.files[0]);
        fr.onload = function (ev) {
            var img = $("<img style='max-width: 100%;max-height: 100%'/>");
            img.prop("src",this.result);
            //alert(this.result);
            $("#mainimg").empty();
            $("#mainimg").append(img);
        }
    });

    /*点击添加介绍图*/
    $(document).on("change","#introImgFile",function () {

        let fr = new FileReader();
        fr.readAsDataURL(this.files[0]);
        fr.onload = function (ev) {
            let img = $("<img style='max-width: 100%;max-height: 100%'/>");
            img.prop("src",this.result);
            //alert(this.result);
            $("#introImg").empty();
            $("#introImg").append(img);
        }
    });

   /*附图列表图片*/
    $(document).on("change","#files",function () {
        for(let i = 0; i < this.files.length; i ++){
            let fr = new FileReader();
            fr.readAsDataURL(this.files[i]);  //将文件读取为DatalURL
            fr.onload = function (ev) {
                var img = new Image();
                img.src = fr.result; //FileReader.result该属性返回文件的内容
                //alert(fr.result);
                let html = '<div class="img_list" id="container" ><img src="'+img.src+'"/></div>'
                $("#container").prepend(html);
            }
        }
    });

    /*回显项目详情*/
    $("#add_item").click(function(){
        setTimeout(function(){
            let itemId = $(".itemId").val();
            let html = "";
            let listImg = "";
            $.post("/item/itemDetail",{itemId:itemId},function(result){
                let dataDetail = result.data;
                let echo_itemId = dataDetail.itemId;
                let echo_itemName = dataDetail.itemName;
                let echo_title = dataDetail.title;
                let echo_developer = dataDetail.developer;
                let echo_originalPrice = dataDetail.originalPrice;
                let echo_price = dataDetail.price;
                let echo_introduce = dataDetail.introduce;
                let echo_imgMain = dataDetail.imgMain;
                let imageList = dataDetail.image;

                for(let i in imageList){ /*副图列表*/
                    let echo_listImg = imageList[i].imgAdd;
                    listImg +=
                        '<img class="echo_listImg" src="/image/'+ echo_itemId +'/'+ echo_listImg +'"/>'
                }
                alert(listImg);
                html =
                    '<div class="display_box">' +
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目分类：</div><div class="display_row" id="echo_parentId">'+ echo_itemId +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目ID：</div><div class="display_row" id="echo_itemId">'+ echo_itemId +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目名称：</div><div class="display_row" id="echo_item_name">'+ echo_itemName +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目标题：</div><div class="display_row" id="echo_title">'+ echo_title +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">发行人：</div><div class="display_row" id="echo_developer">'+ echo_developer +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目原价：</div><div class="display_row" id="echo_originalPrice">'+ echo_originalPrice +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">项目现价：</div><div class="display_row" id="echo_price">'+ echo_price +'</div></div>'+
                    '<div class="row_line"></div>'+
                    '<div>' +
                    '<div class="display_title">内容：</div>' +
                    '<div class="display_row">' +
                    '<div class="content"><div id="echo_introduce"></div>'+ echo_introduce +'</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">主图片：</div><div class="display_row"><img id="echo_imgMain" src="/image/'+ echo_itemId +'/'+ echo_imgMain +'"/></div></div>'+
                    '<div class="row_line"></div>'+
                    '<div><div class="display_title">副图片：</div><div class="display_row">'+ listImg +'</div></div>'+
                    '</div>'+
                    '<div class="line"></div>'

                $("#echo_item").html(html);
                //alert(html);

            });
        }, 30000); /*延时*/
        $("#item_show").css("display","none");
    })



    /*回显项目介绍详情*/
    $("#add_1").click(function(){
        setTimeout(function(){
            //alert("回显开始");
            let itemId = $(".itemId").val();
            //alert("itemId是："+itemId);
            let html = "";
            $.post("/introduce/introduceList",{itemId:itemId},function(result){
                let dataList = result.data;
                for(let i in dataList){
                    let intro_itemId = dataList[i].itemId;
                    let intro_title = dataList[i].introTitle;
                    let intro_content = dataList[i].content;
                    let intro_img = dataList[i].img;

                  /*  $("#introduce_title").html(intro_title);
                    $("#introduce_content").html(intro_content);
                    $("#introduce_img").html(intro_img);*/
                    html +=
                        '<div class="display_box">' +
                            '<div><div class="display_title">标题：</div><div class="display_row" id="introduce_title">'+ intro_title +'</div></div>' +
                            '<div>' +
                                '<div class="display_title">内容：</div>' +
                                '<div class="display_row">' +
                                    '<div class="content"><div id="introduce_content"></div>'+ intro_content +'</div>'+
                                '</div>'+
                            '</div>'+
                            '<div><div class="display_title">图片：</div><div class="display_row"><img id="introduce_img" src="/image/'+ intro_itemId +'/'+ intro_img +'"/></div></div>'+
                        '</div>'+
                        '<div class="line"></div>'
                }
                    $("#echo").html(html);

            });
        }, 500); /*延时*/
            $("#intro_show").css("display","none");
    })

    /*新增一个介绍*/
    $("#add_intro").click(function(){
        $("#introTitle").val("");  /*清除肉容*/
        CKEDITOR.instances.content.setData('');  /*清除编辑器内容*/
        $("#introImg").html('');    /*清除图片内容*/
        $("#intro_show").css("display","block");
    })




    /*拖动添加图片列表*/
   /* document.ondragover = function(e){e.preventDefault();}
    document.ondrop = function(e){e.preventDefault();}
    manimg.ondragover = function(e){e.preventDefault();}
    manimg.ondrop = function(e){
        let f1 = e.dataTransfer.files[0]; //拖拽上传获取上传文件
        let fr = new FileReader();
        fr.readAsDataURL(f1);
        fr.onload = function(){
            var img = new Image();
            img.src = fr.result;
            let image = '<img src="'+img.src+'" style="max-width: 100%;max-height: 100%"/>';
            $("#manimg").prepend(image);
        }
    }*/
    
   /* container.ondragover = function(e){e.preventDefault();}
    container.ondrop = function(e){
        let f0 = e.dataTransfer.files[0];
        let fr = new FileReader();
        fr.readAsDataURL(f0);//把上传的文件对象转换成url
        fr.onload = function(){  //渲染图片
            console.log(fr.result);
            var img = new Image();
            img.src = fr.result; //FileReader.result该属性返回文件的内容
            let html = '<div class="img_list" id="container" ><img src="'+img.src+'"/></div>'
            $("#container").prepend(html);
        }
    }*/






});/*这个括号是layui.use的括号*/

    function save(){
        $(this).disabled = true;
    }




</script>

</body>
</html>