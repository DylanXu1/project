<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="../css/font.css" charset="utf-8">
        <link rel="stylesheet" href="../css/xadmin.css" charset="utf-8">
        <script type="text/javascript" src="../js/jquery.min.js"></script>
        <script type="text/javascript" src="../lib/layui/layui.js"  charset="utf-8" ></script>
        <script type="text/javascript" src="../js/xadmin.js"></script>
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    
    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">人员管理</a>
                <a><cite>教师列表</cite></a>
                    
            </span>
        </div>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <div class="layui-card-header">
                                <button class="layui-btn" onclick="addTeacher()" ><i class="layui-icon"></i>添加教师</button>
                                <button class="layui-btn layui-btn-small"  onclick="location.reload()" title="刷新"><i class="layui-icon layui-icon-refresh"></i></button>
                            </div>
                            <table id="teacherListByorg" lay-filter="test"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <script type="text/html" id="del">
        <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del">禁用</a>
    </script>

    <script type="text/html" id="sex">
        {{#  if(d.sex=='0'){ }}男
        {{#  }else{ }}女
        {{# } }}
    </script>

    <script>
        layui.use(['laydate','table'], function() {
            var laydate = layui.laydate;
            var table = layui.table;

            //执行一个laydate实例
            laydate.render({
                elem: '#start' //指定元素
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });

            //监听表格复选框选择
            table.on('checkbox(test)', function(obj){
                console.log(obj)
            });

            let parentId = JSON.parse(sessionStorage.getItem('userSession')).userId;
            console.log(parentId);
            table.render({
                elem: '#teacherListByorg'       /*表格的id选择器*/
                , url: '/user/teacherListByOid'
                , where: {parentId: parentId}
                , cols: [[
                    {checkbox: true, fixed: true}
                    , {field: 'userSerial', title: 'ID', width: 100,hide: true}/**/
                    , {field: 'phone', title: '手机号(帐号)', width: 180, edit: 'text', minWidth: 80}
                    , {field: 'orgName', title: '所属企业(院校)', width: 180, edit: 'text'}
                    , {field: 'tname', title: '姓名', width: 180, edit: 'text'}
                    /*,{field:'sex',title:'性别',  width:180, edit: 'text',templet:'#sex'}*/
                    , {field: 'createBy', title: '创建人', width: 180, edit: 'text'}
                    , {
                        field: 'createTime',
                        title: '创建时间',
                        width: 650,
                        sort: true,
                        templet: '<div>{{ layui.util.toDateString(d.createTime, "yyyy-MM-dd") }}</div>'
                    }
                    , {field: 'isDelete', title: '操作', templet: '#del', width: 180, minWidth: 100, fixed: 'right'}
                ]]
                , id: 'testReload'
                , toolbar: '#toolbarDemo'
                , page: true

            });


            /*企业端删除教师*/  //监听单元格删除
            table.on('tool(test)', function(obj){
                var data = obj.data;
                if(obj.event === "del"){
                    layer.confirm("你确定要禁用么？",{btn:['确定','取消']},
                        function(index){
                            obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                            layer.close(index);
                            let userSerial = data["userSerial"];   //获取当前行的值
                            $.ajax({
                                url:'/user/stopTeam',
                                type:'post',
                                data:{'userSerial':userSerial},  //向服务端发送删除的id
                                success:function(result){
                                    if(result.code==0000){
                                        layer.msg("已禁用",{icon:6});
                                    }
                                    else{
                                        layer.msg("禁用失败",{icon:5});
                                    }
                                }
                            });
                    })
                }
            });

            //监听单元格编辑
            table.on('edit(test)', function(obj) {
                var value = obj.value //得到修改后的值
                    ,
                    data = obj.data //得到所在行所有键值
                    ,
                    field = obj.field; //得到字段
                layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
            });

            //头工具栏事件
            table.on('toolbar(test)', function(obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'getCheckData':
                        var data = checkStatus.data;
                        layer.alert(JSON.stringify(data));
                        break;
                    case 'getCheckLength':
                        var data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选': '未全选');
                        break;
                };
            });

        });

        function addTeacher(){
            layer.open({
                type: 2,//类型
                title: '添加教师', //窗口名字
                maxmin: true,
                shade: 0.5,  //点击遮罩透明度
                area: ['28%', '35%'],  //定义宽和高 前面是宽，后面是高
                content: 'org-addTeacher.html', //这里content是一个普通的String，打开一个页面  /*这里传一个参数到add-grade-teacher.html页面中*/
            })
        }


    </script>

   <!-- <script type="text/html" id="createTime">
        <div>{{ layui.util.toDateString(d.createTime, "yyyy-MM-dd") }}</div>
    </script>-->

    </body>
</html>