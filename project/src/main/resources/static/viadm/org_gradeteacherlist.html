<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="../css/font.css" charset="utf-8">
        <link rel="stylesheet" href="../css/xadmin.css" charset="utf-8">
        <script type="text/javascript" src="../js/jquery.min.js"></script>
        <script type="text/javascript" src="../lib/layui/layui.js"  charset="utf-8" ></script>
        <script type="text/javascript" src="../js/xadmin.js"></script>
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    
    <body>

        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <table id="gradeTeacherList" lay-filter="test"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script type="text/html" id="del">
        <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del" title="将教师从此班级移除">移除</a>
    </script>

    <script type="text/html" id="sex">
        {{#  if(d.sex=='0'){ }}男
        {{#  }else{ }}女
        {{# } }}
    </script>

    <script>
        layui.use(['laydate','table'], function() {
            var laydate = layui.laydate;
            var table = layui.table;

            //监听表格复选框选择
            table.on('checkbox(test)', function(obj){
                console.log(obj)
            });

            function GetRequest() {
                var url = location.search;
                //alert(url);
                var theRequest = new Object();
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                    }}return theRequest;}
            let Request = new Object();
            Request = GetRequest();
            let gradeId = Request['gradeId'];
            table.render({
                elem: '#gradeTeacherList'       /*表格的id选择器*/
                , url: '/grade/gradeTeacherList'  /*查班级下的教师列表*/
                , where: {gradeId: gradeId}
                , cols: [[
                   /* {checkbox: true, fixed: true}*/
                    {field: 'teacherId', title: 'ID', width: 100, hide: true}
                    , {field: 'phone', title: '手机号(帐号)', width: 180, edit: 'text', minWidth: 80}
                    , {field: 'tname', title: '姓名', width: 180}
                    , {field: '', title: '操作', templet: '#del', width: 150, minWidth: 100, fixed: 'right'}
                ]]
                , id: 'testReload'
                /*, toolbar: '#toolbarDemo'*/
                , page: false

            });


            /*企业端删除教师*/  //监听单元格删除
            table.on('tool(test)', function(obj){
                var data = obj.data;
                if(obj.event === "del"){
                    layer.confirm("你确定要移除么？",{btn:['确定','取消']},
                        function(index){
                            obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                            layer.close(index);
                            let teacherId = data["teacherId"];   //获取当前行的值
                            $.ajax({
                                url:'/grade/delGradeTeacher',
                                type:'post',
                                data:{teacherId:teacherId,gradeId:gradeId},  //向服务端发送删除的id
                                success:function(result){
                                    if(result.code==0000){
                                        layer.msg("移除成功",{icon:6});
                                    }
                                    else{
                                        layer.msg("移除失败",{icon:5});
                                    }
                                }
                            });
                    })
                }
            });



        });



    </script>
    </body>
</html>